[tools]
d2 = "0.7"
go = "1.26"
golangci-lint = "2.10"
goreleaser = "2.13.3"
prek = "0.3"

[env]
CGO_ENABLED = "0"
D2_LAYOUT = "elk"

[tasks.lint]
description = "Run linter"
sources = [
  "**/*.go",
  "go.mod",
  "go.sum",
  ".golangci.yml",
]
run = [
  "golangci-lint run --fix",
]

[tasks.test]
description = "Run all tests"
sources = [
  "**/*.go",
  "go.mod",
  "go.sum",
]
run = "go test -race ./..."

[tasks.check]
description = "Run lint, fmt, and tests"
sources = [
  "**/*.go",
  "go.mod",
  "go.sum",
]
depends = ["lint", "test"]

[tasks.build]
description = "Build the slinky binary"
sources = [
  "**/*.go",
  "go.mod",
  "go.sum",
  ".goreleaser.yaml",
]
outputs = ["dist/*"]
run = "goreleaser build --clean --auto-snapshot"

[tasks.install]
description = "Install slinky to GOPATH/bin"
depends = ["build"]
run = [
  "go install ./cmd/slinky",
  "slinky restart",
]
